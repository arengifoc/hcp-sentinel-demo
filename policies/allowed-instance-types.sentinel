import "tfplan/v2" as tfplan

# Allowed instance types
allowed_types = ["t3.micro", "t3.small"]

# Get all AWS instances
instances = filter tfplan.resource_changes as _, rc {
	rc.type is "aws_instance" and
		rc.mode is "managed" and
		rc.change.actions contains "create"
}

# Main rule
main = rule {
	all instances as _, instance {
		instance.change.after.instance_type in allowed_types
	}
}
